<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Human Sensor</title>

  <!-- Bootstrap -->
  <link href="css/bootstrap.min.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<!--from  ww w .  ja  v a 2  s . c o m-->
</head>
<body>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="js/bootstrap.min.js"></script>

<form id="Production_plan_form">
  <h3 style="margin-left: 30px">Production plan form</h3>
  <br>
  <p style="margin-left: 30px">Date:<input id="datePicker" value="" type="text" style="width:80px"></p>
  <div class="well">

    <table class="table table-responsive">


      <thead>
      <tr class="info">
        <th></th>
        <th>I izmena</th>
        <th>II izmena</th>
        <th>III izmena</th>
        <th>I izmena</th>
      </tr>
      </thead>

      <tbody>

      <tr>
        <td id="1-0" style="background-color: red">KM 1000/1
          <br>
          61282649/001</td>

        <td id="1-1">

          <div class="dropdown">
            <select class="readable_value">
              <option value="X82">X82</option>
              <option value="Delta 3">Delta 3</option>
              <option value="HFE">HFE</option>
              <option value="Nova Insignia">Nova Insignia</option>
              <option value="Corsa 1">Corsa 1</option>
              <option value="Delta 1">Delta 1</option>
              <option value="Default_value" selected>Select type</option>
            </select>
          </div>

            <select class="readable_value2" onchange="selectedField(this)" value="false">
              <option value="X82">X82</option>
              <option value="Delta 3">Delta 3</option>
              <option value="HFE">HFE</option>
              <option value="Nova Insignia">Nova Insignia</option>
              <option value="Corsa 1">Corsa 1</option>
              <option value="Delta 1">Delta 1</option>
              <option value="" selected></option>
            </select>

            <!-- <input id="field-two" readonly type="time" class="readable_value" style="height: 20px; width: 80px;"> -->

            <select id = shiftTime class="time_value" value="test" onchange="validateField(this)">
            <option class="0" value="07:00">07:00</option>
            <option class="1" value="08:00">08:00</option>
            <option class="2" value="09:00">09:00</option>
            <option class="3" value="10:00">10:00</option>
            <option class="4" value="11:00">11:00</option>
            <option class="5" value="12:00">12:00</option>
            <option class="6" value="13:00">13:00</option>
            <option class='7' value="" selected></option>
          </select>
        </td>

        <td id="1-2"></td>
        <td id="1-3"></td>
        <td id="1-4"></td>

      </tr>

      <tr>
        <td id="2-0" style="background-color: orange">KM 1000/2
          <br>
          61282634/001</td>

        <td id="2-1"></td>
        <td id="2-2"></td>
        <td id="2-3"></td>
        <td id="2-4"></td>
      </tr>

      <tr>
        <td id="3-0" style="background-color: lightgreen">KM 1000/3
          <br>
          61282630/001</td>

        <td id="3-1"></td>
        <td id="3-2"></td>
        <td id="3-3"></td>
        <td id="3-4"></td>
      </tr>

      <tr>
        <td id="4-0" style="background-color: lightskyblue">ENGEL 1700/4
          <br>
          61542722/001</td>

        <td id="4-1"></td>
        <td id="4-2"></td>
        <td id="4-3"></td>
        <td id="4-4"></td>
      </tr>

      <tr>
        <td id="5-0" style="background-color: lightgray">ENGEL 1700/5
          <br>
          61542721/001</td>

        <td id="5-1"></td>
        <td id="5-2"></td>
        <td id="5-3"></td>
        <td id="5-4"></td>
      </tr>
      </tbody>
    </table>

    <textarea rows="4" cols="175" placeholder="Write your comments here."></textarea>

    <br>
    <input type="button" value="submit" id="submit"/>
  </div>
</form>
</body>
</html>

<script>


  var form = $("#1-1").html();
  $("#1-1").empty();

  var shift = $('#shiftTime').html();
  $('#shiftTime').empty();

  var workShift = [
          ["07:00", "08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "Select time"],
          ["15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "Select time"],
          ["23:00", "0:00", "01:00", "02:00", "03:00", "04:00", "05:00", "Select time"],
          ["07:00", "08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "Select time"],
          ];

  function validateField(check){
    var myCheck = $(check).parent().attr('id');
    var m = $('#'+myCheck+' .readable_value2').attr('value'); // har id og kan finne verdi

    if(m ==='false'){

      alert('Select type first!');
      $(check).prop('selectedIndex', 7)
    }
  }

  function selectedField(selectField){
    var sel = $(selectField).parent().attr('id'); // må finne id og gjøre value til true.
    var val = $('#'+sel+' .readable_value2').attr('value', 'true');
   // alert($(val).attr('value'));
  }

  for(i = 1; i <6; i++){
    for(k = 1; k < 5; k++) {
      $('#'+i+'-' + k).append(form);
    }
  }

  for(i = 1; i <6; i++){
    for(k = 1; k < 5; k++) {
      for (t = 0; t < 7; t++) {
        $('#' + i + '-' + k + ' .time_value .'+t).text(workShift[k-1][t]);
        $('#' + i + '-' + k + ' .time_value .'+t).val(workShift[k-1][t]);
      }
    }
  }

  $(document).ready(function(){

    var date = new Date();
    var day = date.getDate();
    var month = date.getMonth();
    var year = date.getFullYear();
    $("#datePicker").val(day+"/"+month+"/"+year);

    $('select.time_value').click(function(){
      if($(this).parent().find('option').attr('readOnly')){
        alert('Choose "Select type" first.');
      }
    });

    $('select.readable_value').click(function(){
      $('.readable_value').attr('value').val('true');
      var verdi = document.getElementsByClassName('readable_value').val();
    });

    function sendRequest(values){
      var request = new XMLHttpRequest();

      request.open('POST', 'http://localhost:8080/adapter/productionPlan', false);
      request.setRequestHeader("Content-Type", "application/json");
      request.send(values);
    }

    $('#submit').click(function () {

      var parents = $(this).closest('input').attr('id');

      var answers = [];
      var values = [];
      var time_value = [];
      var names = ["KM 1000/1 61282649/001",
        "KM 1000/2 61282634/001",
        "KM 1000/3 61282630/001",
        "ENGEL 1700/4 61542722/001",
        "ENGEL 1700/5 61542721/001"];

      $.each($('.readable_value'), function() {

        answers.push($(this).val());
      });

      $.each($('.readable_value2'), function() {

        values.push($(this).val());
      });

      $.each($('.time_value'), function() {

        time_value.push($(this).val());
      });

      var n = 0;
      for(i = 0; i < 5; i++) {
        for (shift = 0; shift < 4; shift++) {

          if (!((answers[n] === "Default_value") && (values[n] === ""))) {
            if (values[n] === "") {
              sendRequest(names[i] + "," + (shift + 1) + "," + answers[n]);
            } else {
              sendRequest(names[i] + "," + (shift + 1) + "," + answers[n] + "," + values[n] + "," + time_value[n]);
            }
          }
          n++;
        }
      }
        document.getElementById("Production_plan_form").reset();
      location.reload();
      })
    })

</script>
